<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>ZCP Vault</title>
<style>
body{margin:0;background:#121212;color:#fff;font-family:Arial}
.hidden{display:none}

/* ===== LOCK SCREEN ===== */
#lock{
  position:fixed;inset:0;background:#0d0d0d;
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  z-index:9999;
}
.dots{display:flex;gap:12px;margin-bottom:30px}
.dot{width:14px;height:14px;border:2px solid #777;border-radius:50%}
.dot.filled{background:#fff;border-color:#fff}

.pad{
  display:grid;
  grid-template-columns:repeat(3,70px);
  gap:15px;
}
.key{
  width:70px;height:70px;border-radius:50%;
  background:#1f1f1f;border:1px solid #444;
  display:flex;align-items:center;justify-content:center;
  font-size:22px;cursor:pointer;
}
.key:hover{background:#2a2a2a}

/* ===== APP ===== */
.app{max-width:800px;margin:30px auto;padding:0 20px}
.header{display:flex;justify-content:space-between;align-items:center}
.add-btn{background:#1f1f1f;color:#fff;border:1px solid #444;border-radius:6px;font-size:20px;width:36px;height:36px;cursor:pointer}
#search{width:100%;padding:8px;margin:12px 0;background:#1f1f1f;color:#fff;border:1px solid #333}
.form{display:none;border:1px solid #333;padding:12px;border-radius:8px;margin-bottom:16px;background:#1a1a1a}
input{width:100%;padding:8px;margin:6px 0;background:#222;color:#fff;border:1px solid #333}
button.save{padding:8px 14px;margin-top:8px;background:#2e7dff;border:none;color:#fff;border-radius:6px;cursor:pointer}

.card{background:#1a1a1a;border:1px solid #333;border-radius:8px;padding:10px;margin-top:10px;position:relative;cursor:pointer}
.card-title{font-weight:bold}
.delete-btn{position:absolute;right:10px;top:8px;background:#b00020;color:#fff;border:none;border-radius:50%;width:24px;height:24px;cursor:pointer}
.details{display:none;margin-top:8px;font-size:14px;word-break:break-all}
</style>
</head>
<body>

<!-- üîí Kƒ∞Lƒ∞T EKRANI -->
<div id="lock">
  <div class="dots" id="dots"></div>
  <div class="pad" id="pad"></div>
</div>

<!-- üîì UYGULAMA -->
<div class="app" id="app" style="display:none">
  <div class="header">
    <h1>ZCP</h1>
    <button class="add-btn" onclick="toggleForm()">+</button>
  </div>

  <input id="search" type="text" placeholder="ETƒ∞KET ARA">

  <div class="form" id="form">
    <input id="etiket" type="text" placeholder="ETƒ∞KET">
    <input id="username" type="text" placeholder="KULLANICI ADI / E-POSTA">
    <input id="password" type="text" placeholder="PAROLA">
    <button class="save" onclick="saveEntry()">Kaydet</button>
  </div>

  <div id="list"></div>
</div>

<script>
/* =================================================
   üîê PIN SISTEMI
================================================= */
const REAL_PIN = "956251";
let entered = "";

const dotsEl = document.getElementById("dots");
const padEl  = document.getElementById("pad");
const lockEl = document.getElementById("lock");
const appEl  = document.getElementById("app");

/* 6 nokta olu≈ütur */
for(let i=0;i<6;i++){
  const d=document.createElement("div");
  d.className="dot";
  dotsEl.appendChild(d);
}

/* Tu≈ülar: 789 / 456 / 123 / 0 (ortada) */
const keys = [7,8,9,4,5,6,1,2,3,"",0,""];
keys.forEach(n=>{
  const b=document.createElement("div");
  if(n===""){
    b.style.visibility="hidden";
  }else{
    b.className="key";
    b.innerText=n;
    b.onclick=()=>press(n);
  }
  padEl.appendChild(b);
});

function press(n){
  if(entered.length>=6) return;

  entered += n;
  updateDots();

  if(entered.length===6){
    if(entered === REAL_PIN){
      unlock();
    }else{
      alert("PIN yanlƒ±≈ü!");
      resetPin();
    }
  }
}

function updateDots(){
  document.querySelectorAll(".dot").forEach((d,i)=>{
    d.classList.toggle("filled", i < entered.length);
  });
}

function resetPin(){
  entered="";
  updateDots();
}

function unlock(){
  lockEl.style.display = "none";   // kilit ekranƒ± gider
  appEl.style.display  = "block";  // uygulama a√ßƒ±lƒ±r
}

/* =================================================
   APP
================================================= */
const form = document.getElementById("form");
const listEl = document.getElementById("list");
const searchEl = document.getElementById("search");
const etiketEl = document.getElementById("etiket");

etiketEl.addEventListener("input",e=>e.target.value=e.target.value.toUpperCase());
searchEl.addEventListener("input",e=>{
  e.target.value=e.target.value.toUpperCase();
  render();
});

function toggleForm(){
  form.style.display = form.style.display==="none"?"block":"none";
}

function getData(){
  return JSON.parse(localStorage.getItem("zcp-data")||"[]");
}
function setData(d){
  localStorage.setItem("zcp-data",JSON.stringify(d));
}

/* ---------- ≈ûƒ∞FRELEME ---------- */
async function getKey(pin,salt){
  const enc=new TextEncoder();
  const baseKey=await crypto.subtle.importKey(
    "raw",enc.encode(pin),"PBKDF2",false,["deriveKey"]
  );
  return crypto.subtle.deriveKey(
    {name:"PBKDF2",salt:salt,iterations:100000,hash:"SHA-256"},
    baseKey,{name:"AES-GCM",length:256},
    false,["encrypt","decrypt"]
  );
}

async function encryptText(text){
  const enc=new TextEncoder();
  const iv=crypto.getRandomValues(new Uint8Array(12));
  const salt=crypto.getRandomValues(new Uint8Array(16));
  const key=await getKey(REAL_PIN,salt);
  const cipher=await crypto.subtle.encrypt(
    {name:"AES-GCM",iv},key,enc.encode(text)
  );
  return {iv:[...iv],salt:[...salt],data:[...new Uint8Array(cipher)]};
}

async function decryptText(obj){
  const iv=new Uint8Array(obj.iv);
  const salt=new Uint8Array(obj.salt);
  const data=new Uint8Array(obj.data);
  const key=await getKey(REAL_PIN,salt);
  const plain=await crypto.subtle.decrypt(
    {name:"AES-GCM",iv},key,data
  );
  return new TextDecoder().decode(plain);
}

/* ---------- KAYDET ---------- */
async function saveEntry(){
  const etiket=etiketEl.value.trim();
  const username=document.getElementById("username").value.trim();
  const password=document.getElementById("password").value.trim();
  if(!etiket||!username||!password){
    alert("T√ºm alanlarƒ± doldur");
    return;
  }

  const encUser = await encryptText(username);
  const encPass = await encryptText(password);

  const d=getData();
  d.push({etiket,encUser,encPass});
  setData(d);

  etiketEl.value="";
  document.getElementById("username").value="";
  document.getElementById("password").value="";
  render();
}

/* ---------- Sƒ∞L ---------- */
function deleteEntry(i){
  const d=getData();
  d.splice(i,1);
  setData(d);
  render();
}

/* ---------- Lƒ∞STE ---------- */
function render(){
  const data=getData();
  const q=searchEl.value;
  listEl.innerHTML="";

  data.forEach((item,i)=>{
    if(q && !item.etiket.includes(q)) return;

    const card=document.createElement("div");
    card.className="card";

    const title=document.createElement("div");
    title.className="card-title";
    title.innerText=item.etiket;

    const del=document.createElement("button");
    del.className="delete-btn";
    del.innerText="X";
    del.onclick=e=>{
      e.stopPropagation();
      deleteEntry(i);
    };

    const details=document.createElement("div");
    details.className="details";
    details.innerHTML=`<div>******</div>`;

    let open=false;
    card.onclick=async ()=>{
      if(!open){
        const u=await decryptText(item.encUser);
        const p=await decryptText(item.encPass);
        details.innerHTML=`
          <div><b>Kullanƒ±cƒ±:</b> ${u}</div>
          <div><b>≈ûifre:</b> ${p}</div>
        `;
        details.style.display="block";
        open=true;
      }else{
        details.style.display="none";
        open=false;
      }
    };

    card.appendChild(title);
    card.appendChild(del);
    card.appendChild(details);
    listEl.appendChild(card);
  });
}

render();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Notlarƒ±m</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Arial,Helvetica,sans-serif;
}
.wrap{
  max-width:900px;
  margin:auto;
  padding:15px;
}
input, textarea, button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border:none;
  border-radius:6px;
  font-size:14px;
}
textarea{min-height:90px}
button{
  background:#444;
  color:#fff;
  cursor:pointer;
}
.row{
  display:flex;
  gap:6px;
}
.row button{flex:1}
.hidden{display:none}
.small{font-size:12px;color:#aaa}

/* BA≈ûLIK */
h2{
  display:flex;
  align-items:center;
  gap:10px;
}

/* KLAS√ñRLER */
#folders{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin:10px 0;
}
.folder{
  background:#555;
  padding:8px 14px;
  border-radius:20px;
  cursor:pointer;
}
.folder.active{
  border:2px solid #fff;
  background:#777;
  box-shadow:0 0 8px rgba(255,255,255,.6);
}

/* NOTLAR */
#notes{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:12px;
}
.note{
  background:#6b6b6b;
  color:#000;
  padding:12px;
  border-radius:6px;
  min-height:120px;
  box-shadow:2px 3px 6px rgba(0,0,0,.5);
  cursor:pointer;
  white-space:pre-wrap; /* paragraf */
}
.note.selected{
  outline:3px solid #fff;
}
</style>
</head>

<body>
<div class="wrap">

<!-- Gƒ∞Rƒ∞≈û -->
<div id="loginBox">
  <h2>Giri≈ü</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="≈ûifre">
  <button onclick="login()">Giri≈ü</button>
</div>

<!-- UYGULAMA -->
<div id="appBox" class="hidden">
  <h2>
    NOTLARIM
    <button onclick="togglePanel()">+</button>
  </h2>
  <div class="small">Tasarƒ±mcƒ±: Zeynel Can PAKIR</div>

  <!-- EKLEME PANELƒ∞ -->
  <div id="panel" class="hidden">
    <textarea id="noteText" placeholder="Not yaz (Enter = paragraf)"></textarea>

    <div class="row">
      <button onclick="addNote()">+ Not Ekle</button>
      <button onclick="deleteNote()">- Not Sil</button>
    </div>

    <div class="row">
      <button onclick="addFolder()">+ Klas√∂r</button>
      <button onclick="deleteFolder()">- Klas√∂r</button>
    </div>
  </div>

  <h3>Klas√∂rler</h3>
  <div id="folders"></div>

  <h3>Notlar</h3>
  <div id="notes"></div>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, addDoc, query, where, onSnapshot, deleteDoc, doc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî• Firebase Ayarlarƒ±n */
const firebaseConfig = {
  apiKey: "AIzaSyAPfTIRvh-BEuR2sfdecN3vmiMmzKoH3LM",
  authDomain: "notlarim-62876.firebaseapp.com",
  projectId: "notlarim-62876",
  storageBucket: "notlarim-62876.firebasestorage.app",
  messagingSenderId: "742756530436",
  appId: "1:742756530436:web:390887156b0d6d66b9f851"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentFolder=null;
let selectedNote=null;

/* Gƒ∞Rƒ∞≈û */
window.login=()=>{
  signInWithEmailAndPassword(
    auth,
    email.value.trim(),
    password.value
  ).catch(e=>alert(e.code));
};

/* OTURUM */
onAuthStateChanged(auth,user=>{
  if(user){
    loginBox.classList.add("hidden");
    appBox.classList.remove("hidden");
    loadFolders(user.uid);
  }
});

/* KLAS√ñRLER */
function loadFolders(uid){
  onSnapshot(
    query(collection(db,"folders"),where("uid","==",uid)),
    snap=>{
      folders.innerHTML="";
      snap.forEach(d=>{
        const f=document.createElement("div");
        f.className="folder"+(currentFolder===d.id?" active":"");
        f.textContent=d.data().name;

        f.onclick=()=>{
          currentFolder=d.id;
          loadNotes();
          loadFolders(uid);
        };

        /* PC saƒü tƒ±k */
        f.oncontextmenu=e=>{
          e.preventDefault();
          const n=prompt("Klas√∂r adƒ±",d.data().name);
          if(n) updateDoc(doc(db,"folders",d.id),{name:n});
        };

        /* Mobil basƒ±lƒ± tut */
        let timer;
        f.ontouchstart=()=>{
          timer=setTimeout(()=>{
            const n=prompt("Klas√∂r adƒ±",d.data().name);
            if(n) updateDoc(doc(db,"folders",d.id),{name:n});
          },600);
        };
        f.ontouchend=()=>clearTimeout(timer);

        folders.appendChild(f);
      });
    }
  );
}

/* NOTLAR */
function loadNotes(){
  onSnapshot(
    query(collection(db,"notes"),where("folder","==",currentFolder)),
    snap=>{
      notes.innerHTML="";
      snap.forEach(d=>{
        const n=document.createElement("div");
        n.className="note";
        n.textContent=d.data().text;

        n.onclick=()=>{
          document.querySelectorAll(".note").forEach(x=>x.classList.remove("selected"));
          n.classList.add("selected");
          selectedNote=d.id;
        };

        /* PC saƒü tƒ±k */
        n.oncontextmenu=e=>{
          e.preventDefault();
          const t=prompt("Notu d√ºzenle",d.data().text);
          if(t) updateDoc(doc(db,"notes",d.id),{text:t});
        };

        /* Mobil basƒ±lƒ± tut */
        let timer;
        n.ontouchstart=()=>{
          timer=setTimeout(()=>{
            const t=prompt("Notu d√ºzenle",d.data().text);
            if(t) updateDoc(doc(db,"notes",d.id),{text:t});
          },600);
        };
        n.ontouchend=()=>clearTimeout(timer);

        notes.appendChild(n);
      });
    }
  );
}

/* EKLE / Sƒ∞L */
window.addFolder=async()=>{
  const name=prompt("Klas√∂r adƒ±");
  if(name) await addDoc(collection(db,"folders"),{
    uid:auth.currentUser.uid,
    name
  });
};

window.deleteFolder=async()=>{
  if(!currentFolder) return alert("Klas√∂r se√ß");
  if(confirm("Klas√∂r silinsin mi?")){
    await deleteDoc(doc(db,"folders",currentFolder));
    currentFolder=null;
    notes.innerHTML="";
  }
};

window.addNote=async()=>{
  if(!currentFolder) return alert("√ñnce klas√∂r se√ß");
  if(!noteText.value) return;
  await addDoc(collection(db,"notes"),{
    folder:currentFolder,
    text:noteText.value
  });
  noteText.value="";
};

window.deleteNote=async()=>{
  if(!selectedNote) return alert("Not se√ß");
  await deleteDoc(doc(db,"notes",selectedNote));
  selectedNote=null;
};

window.togglePanel=()=>{
  panel.classList.toggle("hidden");
};
</script>
</body>
</html>

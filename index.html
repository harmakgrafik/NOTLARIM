<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZCP</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#0f1115;color:#eee}

/* -------- ORTAK -------- */
.screen{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#0f1115}
.box{width:300px;background:#151922;border:1px solid #222;border-radius:12px;padding:20px}
.inp{width:100%;margin:6px 0;padding:10px;border-radius:8px;border:1px solid #333;background:#1a1d24;color:#fff}
.btn{width:100%;padding:10px;border:none;border-radius:8px;background:#1f2933;color:#fff;cursor:pointer}
.err{color:#ff5c5c;font-size:13px;text-align:center;display:none}

/* -------- PIN -------- */
#pinScreen{display:none;flex-direction:column}
.dots{
  display:flex;justify-content:center;align-items:center;
  gap:10px;margin:16px 0 20px;
}
.dot{width:12px;height:12px;border:1px solid #555;border-radius:50%}
.dot.on{background:#fff}

.pad{
  display:grid;
  grid-template-columns:repeat(3,64px);
  gap:12px;
  justify-content:center;
}
.key{
  width:64px;height:64px;border-radius:50%;
  background:#1a1d24;border:1px solid #333;color:#fff;
  display:flex;align-items:center;justify-content:center;
  font-size:20px;cursor:pointer
}
.key.zero{grid-column:2}

/* -------- APP -------- */
#app{display:none}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid #222}
#addBtn{background:#1f2933;border:none;color:#fff;border-radius:8px;padding:8px 12px;font-size:18px}
#form{display:none;padding:12px 16px;border-bottom:1px solid #222}
input{width:100%;margin:6px 0;padding:10px;border-radius:8px;border:1px solid #333;background:#1a1d24;color:#fff}
#saveBtn{width:100%;padding:10px;border:none;border-radius:8px;background:#1f2933;color:#fff;font-weight:bold}
#list{padding:12px}
.card{background:#151922;border:1px solid #222;border-radius:12px;padding:10px;margin-bottom:8px;cursor:grab}
.row{display:flex;justify-content:space-between;align-items:center}
.label{font-weight:bold;letter-spacing:1px}
.details{display:none;margin-top:6px;color:#cbd5ff;font-size:14px}
.del{background:#ff3b3b;border:none;color:#fff;border-radius:6px;padding:4px 8px}
</style>
</head>

<body>

<!-- ===== FIREBASE GÄ°RÄ°Åž ===== -->
<div id="loginScreen" class="screen">
  <div class="box">
    <h2 style="text-align:center">GiriÅŸ</h2>
    <input id="loginEmail" class="inp" placeholder="Email">
    <input id="loginPass" class="inp" type="password" placeholder="Åžifre">
    <button id="loginBtn" class="btn">GiriÅŸ</button>
    <div id="loginError" class="err">Bilgiler yanlÄ±ÅŸ</div>
  </div>
</div>

<!-- ===== PIN ===== -->
<div id="pinScreen" class="screen">
  <div class="box" style="text-align:center">
    <h2>PIN</h2>
    <div class="dots">
      <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      <div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>
    <div class="pad">
      <div class="key" data-n="7">7</div>
      <div class="key" data-n="8">8</div>
      <div class="key" data-n="9">9</div>
      <div class="key" data-n="4">4</div>
      <div class="key" data-n="5">5</div>
      <div class="key" data-n="6">6</div>
      <div class="key" data-n="1">1</div>
      <div class="key" data-n="2">2</div>
      <div class="key" data-n="3">3</div>
      <div class="key zero" data-n="0">0</div>
    </div>
  </div>
</div>

<!-- ===== APP ===== -->
<div id="app">
<header>
  <h1>ZCP</h1>
  <button id="addBtn">+</button>
</header>

<div id="form">
  <input id="etiket" placeholder="ETÄ°KET">
  <input id="user" placeholder="KULLANICI ADI">
  <input id="pass" placeholder="PAROLA">
  <button id="saveBtn">Kaydet</button>
</div>

<div id="list"></div>
</div>

<!-- ========== SCRIPT (MODULE) ========== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* ===== Firebase ===== */
const firebaseConfig = {
  apiKey: "AIzaSyAPfTIRvh-BEuR2sfdecN3vmiMmzKoH3LM",
  authDomain: "notlarim-62876.firebaseapp.com",
  projectId: "notlarim-62876",
  storageBucket: "notlarim-62876.firebasestorage.app",
  messagingSenderId: "742756530436",
  appId: "1:742756530436:web:390887156b0d6d66b9f851"
};

const appFB = initializeApp(firebaseConfig);
const auth  = getAuth(appFB);
const db    = getFirestore(appFB);

/* ===== PIN ===== */
const PIN_CODE = "956251";

/* ===== Ekranlar ===== */
const loginScreen = document.getElementById("loginScreen");
const pinScreen   = document.getElementById("pinScreen");
const appScreen   = document.getElementById("app");

/* ===== GiriÅŸ ===== */
const loginBtn = document.getElementById("loginBtn");
const loginErr = document.getElementById("loginError");

loginBtn.onclick = async ()=>{
  const email = document.getElementById("loginEmail").value.trim();
  const pass  = document.getElementById("loginPass").value.trim();
  try{
    await signInWithEmailAndPassword(auth, email, pass);
  }catch{
    loginErr.style.display="block";
  }
};

let currentUser = null;

onAuthStateChanged(auth, user=>{
  if(user){
    currentUser = user;
    loginScreen.style.display="none";
    pinScreen.style.display="flex";
    startListen();   // ðŸ”¥ Firestore senkron baÅŸlar
  }
});

/* ===== PIN ===== */
let entered="";
const dots = document.querySelectorAll(".dot");
document.querySelectorAll(".key").forEach(k=>{
  k.onclick = ()=>{
    if(entered.length>=6) return;
    entered += k.dataset.n;
    dots[entered.length-1].classList.add("on");

    if(entered.length===6){
      if(entered===PIN_CODE){
        pinScreen.style.display="none";
        appScreen.style.display="block";
      }else{
        alert("PIN yanlÄ±ÅŸ");
        resetPin();
      }
    }
  };
});
function resetPin(){
  entered="";
  dots.forEach(d=>d.classList.remove("on"));
}

/* ===== APP ===== */
const addBtn  = document.getElementById("addBtn");
const form    = document.getElementById("form");
const saveBtn = document.getElementById("saveBtn");
const list    = document.getElementById("list");

addBtn.onclick = ()=> {
  form.style.display = form.style.display==="none" ? "block" : "none";
};

let items = []; // Firestoreâ€™dan gelecek

/* ===== Firestore Dinleme ===== */
function startListen(){
  const colRef = collection(db, "users", currentUser.uid, "items");
  onSnapshot(colRef, snap=>{
    items = snap.docs.map(d=>({id:d.id, ...d.data()}))
                     .sort((a,b)=>b.created - a.created);
    render();
  });
}

/* ===== Render ===== */
function render(){
  list.innerHTML="";
  items.forEach((it,i)=>{
    const c = document.createElement("div");
    c.className="card";
    c.draggable=true;

    c.innerHTML = `
      <div class="row">
        <div class="label">${it.label}</div>
        <button class="del">X</button>
      </div>
      <div class="details">
        <div>KullanÄ±cÄ±: ${it.user}</div>
        <div>Åžifre: ${it.pass}</div>
      </div>
    `;

    c.onclick = (e)=>{
      if(e.target.classList.contains("del")) return;
      const d = c.querySelector(".details");
      d.style.display = d.style.display==="none"?"block":"none";
    };

    c.querySelector(".del").onclick = async ()=>{
      await deleteDoc(doc(db,"users",currentUser.uid,"items",it.id));
    };

    list.appendChild(c);
  });
}

/* ===== Kaydet ===== */
saveBtn.onclick = async ()=>{
  const label = document.getElementById("etiket").value.toUpperCase().trim();
  const user  = document.getElementById("user").value.trim();
  const pass  = document.getElementById("pass").value.trim();

  if(!label||!user||!pass){ alert("Hepsini doldur"); return; }

  await addDoc(collection(db,"users",currentUser.uid,"items"),{
    label,user,pass,
    created: Date.now()
  });

  document.getElementById("etiket").value="";
  document.getElementById("user").value="";
  document.getElementById("pass").value="";
  form.style.display="none";
};
</script>

</body>
</html>
